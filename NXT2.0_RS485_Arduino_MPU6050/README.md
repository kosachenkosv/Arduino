# Lego NXT2.0 - RS485 - Arduino - i2c - mpu6050
Arduino Sketch & NXC Sketch

Arduino ждет от Lego NXT2.0 через RS485 на SoftwareSerial команду "1" = "передать угол Z c гироскопа MPU6050"

Pins:

10 - RX SoftSerial (RO MAX485)

11 - TX SoftSerial (DI MAX485)

12 - RE/DE MAX485 (low - recive, high - send)

A5 - SCL MPU6050 (i2c)

A4 - SDA MPU6050 (i2c)

 LEGO NXT2.0:

Blue (1 pin) A MAX485

Yellow (2 pin) B MAX485

Green (3 pin) Vin Arduino

Red (4 pin) GND Arduino & GND RS485 & GND MPU6050

Black - no

White - no

Датчик гироскоп для Lego NXT2.0 работает так:

1) при включении Лего включается и подключенные к порту 4 проводом Arduino, mpu6050, max485 (на них загораются светодиоды)

2) Arduino  при старте загружает по протоколу i2c микропрограмму в гироскоп mpu6050, чтобы вести числовую обработку на встроенном числовом процессоре (Digital Motion Processor)

3) Лего отправляет на ардуино через протокол RS485, который обеспечивает микросхема MAX485, символ "1" (это знак "единица" код 49). Arduino, когда получила "1", по протоколу i2c получает значение угла по оси Z в радианах с гироскопа mpu6050, переводит его в градусы и возвращает на LEGO NXT2.0 как двухбайтовое значение int

Замечено: при включении первые 10-12 секунд наблюдается дрифт гироскопа примерно в 12 градусов, после чего дрифт гироскопа останавливается. Это важно учесть во время игры, в начале калибровки робота нужно повернуть на ворота соперника и потом еще довернуть на 12 градусов по часовой стрелке и подождать 12 секунд, после чего можно начинать игру.

Важно! Для компиляции nxc требуется расширенная прошивка (enhanced firmware) для Lego NXT2.0, тестировал на версии 132, которую скачал с сайта Brixx. При компиляции nxc программы с RS485 нужно включить опцию -EF

nbc -EF -d %f
